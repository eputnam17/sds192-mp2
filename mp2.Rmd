---
title: "Mini-Project 2"
author: "Sarah Gillespie, Berry Williams, Eva Putman"
date: "2019-03-24"
output: 
  html_document:
    code_folding: hide
---


```{r, message=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(lubridate)
library(scales)
```

```{r, message=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
devtools::install_github("benmarwick/wordcountaddin")
```

> Word count: `r wordcountaddin::word_count()`


```{r, message=FALSE}

# Splits contributions into the date the contribution occurred, transaction amount, and the the recipient's ID

ContributionsToEach <- contributions %>%
  dplyr::select(transaction_dt, tran_id, transaction_amt, cand_id, name) %>%
  # The date format was weird and ineffective so this splits it into 3 columns, for year, month, and day. I used "lubridate" which should be part of tidyverse
  
  dplyr::mutate(FullDate = mdy(transaction_dt)) %>%
  separate(FullDate, sep="-", into = c("year", "month", "day"))

#add party variable

ContributionsToEach$party <- ifelse(ContributionsToEach$name == "MUNDY KATOWITZ MEDIA, INC.," | ContributionsToEach$name == "GMMB", 
c("Democrat"), c("Republican"))

BigContributions2012 <- ContributionsToEach %>%
  filter(year == "2012") %>%
  filter(transaction_amt > 3000000)
```
 
 
```{r}
glimpse(BigContributions2012)
```

```{r, message=FALSE}
# I loaded the scales package, which should be in ggplot of tidyverse to make the transaction amount be in dollars and not exponents

ggplot(ContributionsToEach, aes(x = as.Date(transaction_dt, "%m%d%Y"), y = transaction_amt, color = party)) + 
  scale_color_manual(values=c("#0000ff", "#ff0000")) +
  scale_y_continuous(labels = dollar) +
  geom_point() +
  labs(title = "Increased Contributions in the 2012 Election", y = "transaction amount", x = "transaction date") +
scale_x_date()
```


```{r, message=FALSE}

# We had to web search to verify the party alignment of each major media company
# Democrat = MUNDY KATOWITZ MEDIA, GMMB, . Republican = MENTZER MEDIA SERVICES,CROSSROADS MEDIA, NATIONAL MEDIA RESEARCH PLANNING(?), AMERICAN RAMBLER PRODUCTIONS,

# A ggplot 2012 contributions on a log scale with text saying who donated each big donation.

ggplot(BigContributions2012, aes(x = as.Date(transaction_dt, "%m%d%Y"), y = transaction_amt, label = name, color = party)) +
  scale_color_manual(values=c( "#0000ff","#ff0000")) +
  scale_y_log10(labels = dollar) +
  geom_text_repel(size = 2) +
  geom_point(size = .5) +
  labs(title = "Top 50 Election Contributions of 2012", x = "month", y = "transaction amount") +
  scale_x_date(breaks = "month", labels = month.abb)
```



```{r, message=FALSE}

# idk what I did but please please please don't delete "dplyr::" in these. It seems redundant but it's the only way it worked.

# this joins the original candidates and contributions tables based on being linked by the unique candidate ID

CandidatesProfile <- dplyr::left_join(candidates, contributions, by = "cand_id")

CountNumberOfDonations <- CandidatesProfile %>%
  dplyr::select(cand_id, cand_name) %>%
  dplyr::group_by(cand_name) %>%
  dplyr::summarize(N = n()) %>%
  dplyr::distinct()

BabyTable <- CandidatesProfile %>%
  dplyr::select(cand_id, cand_name, transaction_amt)

# the numeric value that these function  produces is the total $ that was given to each house candidate. Find it by putting in the individual's candidate ID.

MoneyPerCandidate <- function(name_id) {
  BabyTable %>%
    dplyr::filter(cand_id == name_id) %>%
    dplyr::filter(!is.na(transaction_amt)) %>%
    dplyr::arrange(transaction_amt) %>%
    dplyr::summarize(total = sum(transaction_amt))
#  return(total)
}

#pick your candidate. Enter his or her ID.
MoneyPerCandidate("P80003338")
MoneyPerCandidate("P80003353")
MoneyPerCandidate("H0NY04065")


#whos who is literally just to join the dataframes
WhosWho <- candidates %>%
  dplyr::select(cand_id, cand_name, cand_party_affiliation)

CountNumberOfDonations <- merge(WhosWho, CountNumberOfDonations, by="cand_name")
  
# lets make a ggplot to see what candidate recieved the most (individual not total dollar) donations

ManyDonations <- CountNumberOfDonations %>%
  dplyr::filter(N > 1500)

ggplot(ManyDonations, aes(x = cand_name, y = N, fill = cand_party_affiliation)) +
  scale_fill_manual(values=c("#0000ff","#ff0000")) +
  geom_bar(stat="identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Most Individual Donations to a Candidate")


```


^[[Github Repository](https://github.com/eputnam17/sds192-mp2)
]