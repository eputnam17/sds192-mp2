---
title: "Mini-Project 2"
author: "Sarah, Berry, Eva"
date: "2019-03-24"
output: 
  html_document:
    code_folding: show
---


```{r, message=FALSE}
library(tidyverse)
library(dplyr)
library(lubridate)
library(scales)
```

```{r, message=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
devtools::install_github("benmarwick/wordcountaddin")
```

> Word count: `r wordcountaddin::word_count()`

```{r, message=FALSE}

# Splits contributions into the date it occurred, transaction amount, and the the recipient's ID
ContributionsToEach <- contributions %>%
  select(transaction_dt, tran_id, transaction_amt, cand_id, name) %>%
# The date format was weird and ineffective so this splits it into 3 columns, for year, month, and day. I used "lubridate" which should be part of tidyverse
  mutate(FullDate = mdy(transaction_dt)) %>%
  separate(FullDate, sep="-", into = c("year", "month", "day"))

#add party variable
ContributionsToEach$party <- ifelse(ContributionsToEach$name == "MUNDY KATOWITZ MEDIA, INC.," | ContributionsToEach$name == "GMMB", 
c("Democrat"), c("Republican"))

# There are some weird negative contribution amounts, which I assume are cancelled checks. We should do a better job removing those but it was really skewing the data so I removed the negative contributions and did calculations from here on with only postive contributions
ContributionsToEachPositive <- ContributionsToEach %>%
  filter(transaction_amt > 0)

#Can we filter out cancelled transactions by filtering out any observation that has a non-unique tran_id? Let's look at contributions for one candidate who had a lot of cancelled donations:
ContributionsToConyers <- ContributionsToEach %>% filter(cand_id == "H6MI01028")
#No - because cancellations receive a unique tran_id. Looking at this dataset, there are many cases where I can't figure out which transaction matches with each cancellation, so I do not think it is possible to filter out cancelled donations with the information we have - we could filter out the negative transactions, but then we would still have the donations that were cancelled. 

BigContributions2012 <- ContributionsToEachPositive %>%
  filter(year == "2012") %>%
  filter(transaction_amt > 3000000) 
  
  #BigContributions2012$party <- ifelse(BigContributions2012$name == "MUNDY KATOWITZ MEDIA, INC.," | BigContributions2012$name == "GMMB", 
#c("Democrat"), c("Republican"))
    

glimpse(BigContributions2012)
```

```{r, message=FALSE}
# everything
# I loaded the scales package, which should be in ggplot of tidyverse to make the transaction amount be in dollars and not exponents
ggplot(ContributionsToEachPositive, aes(x = transaction_dt, y = transaction_amt, color = party)) + 
  scale_color_manual(values=c("#0000ff", "#ff0000")) +
  scale_y_continuous(labels = dollar) +
  geom_point() +
  labs(title = "Large Contributions in the 2012 Presidential Campaign")
```


```{r, message=FALSE}

# just 2012 contributions on a log scale with text saying who donated each big donation.
# Democrat = MUNDY KATOWITZ MEDIA, GMMB, . Republican = MENTZER MEDIA SERVICES,CROSSROADS MEDIA, NATIONAL MEDIA RESEARCH PLANNING(?), AMERICAN RAMBLER PRODUCTIONS,

ggplot(BigContributions2012, aes(x = transaction_dt, y = transaction_amt, label = name, color = party)) +
  scale_color_manual(values=c("#0000ff", "#ff0000")) +
  scale_y_log10(labels = dollar) +
  geom_text(size = 2) +
  geom_point(size = .5) +
  labs(title = "Top 50 Contributions to the 2012 Presidential Campaign", x = "transaction date", y = "transaction amount") 
```

```{r, message=FALSE}
# joining the tables (documentation; look for header of combine data sets at https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)
# we care about how many contributions each candidate got. (or total money they got?)
# we will find the number of intances the candidate ID shows up
# count how many times the candidate ID appeared -> mutate that into a new collumn
# join that collumn (based on candiate ID) to the main "candidates" column
# in the end, we will have the original candidates spreadsheet and then two extra columns of number of individual contributions and total money donated to each candidate

NewCandidates <- dplyr::left_join(candidates, contributions, by = "cand_id")

# semi_join(a, b, by = "x1")

CountNumberOfDonations <- NewCandidates %>%
  dplyr::group_by(cand_name) %>%
  dplyr::summarize(N = n())

```

#im just going to type up anything that sounds interesting or possibly relevent for our write up. Feel free to edit any of it

Although all United States presidential elections are unique, the 2011 â€“ 2012 campaign data is particularly interesting. In addition to the first time in U.S. history that an African American incumbent president ran for re-election, this was the first election to occur after the 2010 Supreme Court opinion, Citizens United, which removed many of the restrictions regulating political campaign spending. 
